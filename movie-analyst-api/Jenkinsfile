node {
    stage('Checkout scm') {
        checkout scm
    }

    stage('Run test') {
        dir ('movie-analyst-api') {
            withEnv([
                'PORT=3000',
                'DB_HOST=db',
                'DB_USER=applicationuser',
                'DB_PASS=applicationuser',
                'DB_NAME=movie_db'
            ]) {
                docker.image('node:10.11.0-alpine').inside("--link ${c.id}:db") {
                    echo 'Performing tests'
                    sh 'npm install'
                    sh 'npm test'
                }
            }
        }
    }

    stage('Build docker image') {
        echo "Not yet"
    }
}